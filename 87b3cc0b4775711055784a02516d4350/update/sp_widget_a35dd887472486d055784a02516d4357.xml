<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller = function ($scope) {
	var c = this;
	$scope.obj=[];
	$scope.count=0;
	$scope.value=false;


	var policy = sessionStorage.getItem('policy');
	if (policy) {
		policy = JSON.parse(policy);
		$scope.policynumber = policy.policyNumber;
	}



	c.server.get({"action":"create" , "value": $scope.policynumber , "value1":$scope.insurance}).then(function (res){
		//		$scope.url1=res.data.url;
		$scope.obj=res.data.array[0];
		//		alert(JSON.stringify($scope.obj))

		$scope.obj1 = res.data.array1[0];
		//	alert(JSON.stringify($scope.obj1));
		$scope.obj2 = res.data.array2[0];
		//	alert(JSON.stringify(res.data.array2[0].success));


		$scope.insurance =  res.data.array2[0].status;
		if($scope.insurance =="Success")
		{
			$scope.insurance ="Success";
			$scope.Color='green';
			$scope.ButValue="Claimed";
			$scope.value=true;
		}
		else{
			$scope.Color='red';
			$scope.ButValue="Claim Insurance";
			$scope.insurance = "In Progress";
		}


		$scope.ClaimInsurance = function(){
			 var policyAmount = prompt("Please enter the amount you would like to claim", "");
			c.server.get({"method" :"claim", "Value" : policyAmount, "value2" : $scope.policynumber }).then(function(res){
				
			});
			$scope.insurance = "Success";
			$scope.Color = "green";
					$scope.ButValue="Claimed";

			$scope.count+=1;
			//	 	alert($scope.count);
		}
	});



};
]]></client_script>
        <controller_as>c</controller_as>
        <css>.bg-img {
  /* Add your background image styles here */
}

.form-container {
  margin-top: 20px; /* Adjust as needed */
  padding: 20px;
  /* Add a background color */
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* Add a shadow effect */
}

h1 {
  margin-top: 0; /* Remove margin */
  text-align: center; /* Center align the heading */
}

.section {
  padding: 20px;
}

.policy-table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 20px;
}

.policy-table th,
.policy-table td {
  padding: 10px;
  text-align: center; /* Center align table content */
  border: none;
}

.policy-table th {
  font-size: 15px;
}

.pdf-link {
  display: inline-block;
  width: 200px;
  margin: 20px auto;
  text-align: center;
}

.pdf-link img {
  width: 100%; /* Adjust image width */
  border-radius: 10px;
}

.but1 {
  background-color: #e86020;
  color: #fff;
  padding: 10px 20px; /* Adjust padding */
  border: none;
  border-radius: 10px;
  cursor: pointer;
  display: block;
  width: 150px;
  margin: 20px auto;
}

.spacing {
  padding:10px;
}

</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id/>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {
  
}]]></link>
        <name>policy claim</name>
        <option_schema/>
        <public>true</public>
        <roles/>
        <script><![CDATA[(function() {
	/* populate the 'data' object */
	/* e.g., data.table = $sp.getValue('table'); */
	data.array = [];
	data.array1 = [];
	data.array2 = [];
	data.status=""
	var url = "";
	var status = "";
	var sys=" ";
	
	




	
	
	
	

	if(input && input.action == "create"){
//	gs.addInfoMessage(input.value)

		var gr = new GlideRecord('x_rptp_insureme_payment_details');
		gr.addQuery('number',input.value);
		gr.query();

		if(gr.next()){
			sys=gr.getValue("sys_id");

			//	gs.addErrorMessage(gr.getValue("sys_id"));
			var Success = gr.getDisplayValue('claim_status');
			data.array2.push({
				status : Success
			});

			gr.claim_status = 2;
			gr.update();
			//	gs.addInfoMessage( gr.getValue('insurer_code'));
			data.array.push({
				productCode : gr.getValue('product_code'),
				insurerCode : gr.getValue('insurer_code').split('_').join(" "),
				premiumamount: gr.getValue('amount'),
				Sum : gr.getValue('sum'),
				name : gr.getValue('primary_user')


			});
				if (input && input.method == "claim") {
    
    var claim = new GlideRecord('x_rptp_insureme_claim_table');
    claim.query();
	gs.addInfoMessage(input.value2);
	
	gs.addErrorMessage(JSON.stringify(data.array))
     
    if (claim.next()) {

            claim.initialize(); 
            claim.status = 2;
          //  claim.sum_insured =dsa ;
         //   claim.amount_claim = dsa;
         //   claim.insert(); 
    } else {
      //  claim.amount_claim = input.Value;
       // claim.update(); 
    }
}
			
			gr1 = new GlideRecord('sys_attachment');
			gr1.addQuery('table_sys_id',sys);
			gr1.query();
			//gs.addInfoMessage(sys)
			if (gr1.next()) {
				//			gs.addInfoMessage("hii"+sys)
				var url1 = gs.getProperty('glide.servlet.uri') + gr1.getLink(false);
				//gs.addInfoMessage(url1); // Use url1 instead of url
				data.array1.push({
					url: url1
				});
			}
			
	//		gs.addErrorMessage(gr.getValue('sum'));
			
		
			
		}
		
	}


})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>Surya.Prathap</sys_created_by>
        <sys_created_on>2024-02-28 10:49:25</sys_created_on>
        <sys_id>a35dd887472486d055784a02516d4357</sys_id>
        <sys_mod_count>337</sys_mod_count>
        <sys_name>policy claim</sys_name>
        <sys_package display_value="SmartAssurance" source="x_rptp_insureme">87b3cc0b4775711055784a02516d4350</sys_package>
        <sys_policy/>
        <sys_scope display_value="SmartAssurance">87b3cc0b4775711055784a02516d4350</sys_scope>
        <sys_update_name>sp_widget_a35dd887472486d055784a02516d4357</sys_update_name>
        <sys_updated_by>Ajmal.akram</sys_updated_by>
        <sys_updated_on>2024-03-05 10:06:01</sys_updated_on>
        <template><![CDATA[<body class = "bg-img">
  <div class="form-container" >

    <section class="section">
      <h1>Your Policy Details</h1>
      <hr>
      <table class="policy-table">
        <tr>
          <th>SL. No</th>
          <th>Policy Number</th>
          <th>Product Code</th>
          <th>Insurer Code</th>
          <th>Premium Amount</th>
          <th>Sum Insured</th>
          <th>Applicant Name</th>
          <th>Status</th>
          <th>Claim Insurance</th>
          <th></th>
        </tr>
        <tr class = "spacing">
          <td>1</td>
          <td>{{policynumber}}</td>
          <td>{{obj.productCode}}</td>
          <td>{{obj.insurerCode}}</td>
          <td>{{obj.premiumamount}}</td>
          <td>{{obj.Sum}}</td>
          <td>{{obj.name}}</td>
          <td><h4 style="color: {{Color}};">{{insurance}}</h4></td>

          <td><a herf=""  ng-disabled="value" ng-click="ClaimInsurance()"><button class="but1">
            {{ButValue}}</button></a>
          </td>
         <td>
    <a href="{{obj1.url}}" class="pdf-link" target="_blank" download="document.pdf">
        <button type="button" class="btn btn-link">
            <span id="boot-icon" class="bi bi-download" style="    font-size: 50px;
    -webkit-text-stroke-width: 4px;
    color: black;"></span>
        </button>
    </a>
</td>

        </tr>
      
      </table>
    </section>
  </div>


</body>


]]></template>
    </sp_widget>
</record_update>
