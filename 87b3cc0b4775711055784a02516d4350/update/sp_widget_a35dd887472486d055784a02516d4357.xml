<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller = function ($scope) {
	var c = this;
	$scope.obj=[];
	$scope.count=0;
	$scope.value=false;
	$scope.modalVisible = false;
	$scope.obj1=[];
	
	var policy = sessionStorage.getItem('policy');
	if (policy) {
		policy = JSON.parse(policy);
		$scope.policynumber = policy.policyNumber;
	}



	c.server.get({"action":"create" , "value": $scope.policynumber , "value1":$scope.insurance}).then(function (res){
		//		$scope.url1=res.data.url;
		$scope.obj=res.data.array[0];
		//		alert(JSON.stringify($scope.obj))

		$scope.obj1 = res.data.array1[0];
		//	alert(JSON.stringify($scope.obj1));
		$scope.obj2 = res.data.array2[0];
		//	alert(JSON.stringify(res.data.array2[0].success));


		$scope.insurance =  res.data.array2[0].status;


		if($scope.insurance =="Success")
		{
			$scope.insurance ="Success";
			$scope.Color='green';
			$scope.ButValue="Claimed";
			$scope.value=true;
		}
		else{
			$scope.Color='red';
			$scope.ButValue="Claim Insurance";
			$scope.insurance = "In Progress";
		}

		$scope.ClaimInsurance = function() {
				$scope.modalVisible = true; 
		//	$scope.modalVisible = false; 
			$scope.insurance = "Success";
			$scope.Color = "green";
			$scope.ButValue = "Claimed";

		};
		$scope.ClaimInsurance1 = function(){

			obj1 = {
				"amount" : $scope.claimAmount,
				"reason" : $scope.claimReason
			};

			$scope.Result = JSON.parse(JSON.stringify(obj1.amount));
			$scope.Result1 =JSON.parse(JSON.stringify(obj1.reason));

			c.server.get({"method" :"claim", "Value" : $scope.Result , "value2" : $scope.policynumber , "value3" :$scope.Result1}).then(function(res){

			});
		}


	});





};
]]></client_script>
        <controller_as>c</controller_as>
        <css>.bg-img {
  /* Add your background image styles here */
}

.form-container {
  margin-top: 20px; /* Adjust as needed */
  padding: 20px;
  /* Add a background color */
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* Add a shadow effect */
}

h1 {
  margin-top: 0; /* Remove margin */
  text-align: center; /* Center align the heading */
}

.section {
  padding: 20px;
}

.policy-table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 20px;
}

.policy-table th,
.policy-table td {
  padding: 10px;
  text-align: center; /* Center align table content */
  border: none;
}

.policy-table th {
  font-size: 15px;
}

.pdf-link {
  display: inline-block;

  margin: 20px auto;
  text-align: center;
}

.pdf-link img {
  width: 100%; /* Adjust image width */
  border-radius: 10px;
  padding-left:0px;
}

.but1 {
  background-color: #e86020;
  color: #fff;
  padding: 10px 20px; /* Adjust padding */
  border: none;
  border-radius: 10px;
  cursor: pointer;
  display: block;
  width: 150px;
  margin: 20px auto;
}

.spacing {
  padding:10px;
}


</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id/>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {
  
}]]></link>
        <name>policy claim</name>
        <option_schema/>
        <public>true</public>
        <roles/>
        <script><![CDATA[(function() {
	/* populate the 'data' object */
	/* e.g., data.table = $sp.getValue('table'); */
	data.array = [];
	data.array1 = [];
	data.array2 = [];
	data.status=""
	var url = "";
	var status = "";
	var sys=" ";

	if(input && input.action == "create"){
//	gs.addInfoMessage(input.value)

		var gr = new GlideRecord('x_rptp_insureme_payment_details');
		gr.addQuery('number',input.value);
		gr.query();

		if(gr.next()){
			sys=gr.getValue("sys_id");

			//	gs.addErrorMessage(gr.getValue("sys_id"));
			var Success = gr.getDisplayValue('claim_status');
			data.array2.push({
				status : Success
			});

			gr.claim_status = 2;
			gr.update();
			//	gs.addInfoMessage( gr.getValue('insurer_code'));
			data.array.push({
				productCode : gr.getValue('product_code'),
				insurerCode : gr.getValue('insurer_code').split('_').join(" "),
				premiumamount: gr.getValue('amount'),
				Sum : gr.getValue('sum'),
				name : gr.getValue('primary_user')


			});

			
			gr1 = new GlideRecord('sys_attachment');
			gr1.addQuery('table_sys_id',sys);
			gr1.query();
			//gs.addInfoMessage(sys)
			if (gr1.next()) {
				//			gs.addInfoMessage("hii"+sys)
				var url1 = gs.getProperty('glide.servlet.uri') + gr1.getLink(false);
				//gs.addInfoMessage(url1); // Use url1 instead of url
				data.array1.push({
					url: url1
				});
			}
			
	//		gs.addErrorMessage(gr.getValue('sum'));
			
		
			
		}
		
	}
					if (input && input.method == "claim") {
    
    var claim = new GlideRecord('x_rptp_insureme_claim_table');
    claim.query();
	gs.addInfoMessage(input.value2);
	   
    if (claim.next()) {
			
		var tb = new GlideRecord('x_rptp_insureme_payment_details');
		tb.addQuery('number',input.value2);
		tb.query();
			if(tb.next()){
            claim.initialize(); 
            claim.status = 2;
				claim.policy_number = tb.sys_id;
           claim.sum_insured = tb.sum;
           claim.amount_claim = JSON.parse(input.Value);
				claim.claiming_reason = input.value3;
            claim.insert(); 
  
    } else {
        claim.amount_claim = input.Value;
        claim.update(); 
    }
		}
}


})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>Surya.Prathap</sys_created_by>
        <sys_created_on>2024-02-28 10:49:25</sys_created_on>
        <sys_id>a35dd887472486d055784a02516d4357</sys_id>
        <sys_mod_count>474</sys_mod_count>
        <sys_name>policy claim</sys_name>
        <sys_package display_value="SmartAssurance old" source="x_rptp_insureme">87b3cc0b4775711055784a02516d4350</sys_package>
        <sys_policy/>
        <sys_scope display_value="SmartAssurance old">87b3cc0b4775711055784a02516d4350</sys_scope>
        <sys_update_name>sp_widget_a35dd887472486d055784a02516d4357</sys_update_name>
        <sys_updated_by>Ajmal.akram</sys_updated_by>
        <sys_updated_on>2024-03-06 07:35:16</sys_updated_on>
        <template><![CDATA[<body class = "bg-img">
  <div class="form-container" >

    <section class="section">
      <h1>Your Policy Details</h1>
      <hr>
      <table class="policy-table">
        <tr>
          <th>SL. No</th>
          <th>Policy Number</th>
          <th>Product Code</th>
          <th>Insurer Code</th>
          <th>Premium Amount</th>
          <th>Sum Insured</th>
          <th>Applicant Name</th>
          <th>Status</th>
          <th ng-show = "!modalVisible" >Claim Insurance</th>

          <th></th>
        </tr>
        <tr class = "spacing">
          <td>1</td>
          <td>{{policynumber}}</td>
          <td>{{obj.productCode}}</td>
          <td>{{obj.insurerCode}}</td>
          <td>{{obj.premiumamount}}</td>
          <td>{{obj.Sum}}</td>
          <td>{{obj.name}}</td>
          <td><h4 style="color: {{Color}};">{{insurance}}</h4></td>

          <td>
            <a href=""  ng-click="ClaimInsurance()">
              <button  ng-show = "!modalVisible" type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal" style="background-color: #e86020; border-radius: 10px">
                {{ButValue}}
              </button>
            </a>
          </td>

          <td>
            <a href="{{obj1.url}}" class="pdf-link" target="_blank" download="document.pdf">
              <button type="button" class="btn btn-link">
                <span id="boot-icon" class="bi bi-download" style="    font-size: 30px;
                                                                   -webkit-text-stroke-width: 2px;
                                                                   color: black;"></span>
              </button>
            </a>
          </td>

        </tr>

      </table>
      <hr>
      <table class="policy-table" ng-show ="modalVisible" >
        <h1>Claim Details</h1>
        <hr>
        <tr>
          <th>SL. No</th>
          <th>Amount Claimed</th>
          <th>Reason</th>
          <th>Status</th>
        </tr>
        <tr class = "spacing">
          <td>1</td>
          <td>{{Result}}</td>
          <td>{{Result1}}</td>
          <td>{{ButValue}}</td>
        </tr>

      </table>

      <!-- Modal --><div  class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true"  >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Claiming Reason</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <!-- Add two input fields for claim amount and reason -->
            <div class="form-group">
              <label for="claimAmount">Claim Amount:<span></span></label>
              <input type="text" class="form-control" id="claimAmount" ng-model="claimAmount" placeholder="Enter claim amount" ng-max = "obj.sum">
            {{obj.Sum}}  
            </div>
            <div class="form-group">
              <label for="claimReason">Claim Reason:</label>
              <textarea class="form-control" id="claimReason" rows="3" placeholder="Enter claim reason" ng-model="claimReason"></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" ng-click="ClaimInsurance1()" data-dismiss="modal">Save changes</button>
          </div>
        </div>
      </div>
      </div>






    </section>

  </div>


</body>


]]></template>
    </sp_widget>
</record_update>
