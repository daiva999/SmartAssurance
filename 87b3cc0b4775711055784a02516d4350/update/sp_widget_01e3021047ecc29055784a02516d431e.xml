<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller = function($scope,$timeout) {
	var c = this;
	c.submit = function(){
		// alert("clicked");
		c.data.temp1 = c.pn;
		c.data.temp2 = c.pdes;
		c.data.temp3 = c.pc;
		c.data.temp4 = c.pimg;
		c.data.temp5 = c.cName;
		alert(c.pimg)	
	if (!c.data.temp5.trim()|| !c.data.temp1.trim() || !c.data.temp3.trim()) 
		{
			return;
		}
		else {
			// alert("else");
			c.server.update().then(function (response) {
				// alert("server");
				if (response.errorMessage) {
					c.errorMessage = response.errorMessage;
					c.successMessage = null;
				} else {
					c.successMessage = response.successMessage;
					c.errorMessage = null;

					$timeout(function () {
						location.href = "/ap?id=" + c.options.redirect_url;
					}, 1500);
				}
			}).catch(function (error) {
				c.successMessage = null;
			});
		}
	}
};]]></client_script>
        <controller_as>c</controller_as>
        <css>.goBack {
  position: relative;
  width: 100px;
  height: 40px; 
}

.goBack i {
  display: inline-block;
  transition: opacity 0.3s ease-out;
}

.goBack::before {
  content: 'Go back';
  display: none;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.goBack:hover i {
  opacity: 0;
}

.goBack:hover::before {
  display: inline-block;
}

input[type=text], select {
  width: 100%;
  padding: 12px 20px;
  margin: 8px 0;
  display: inline-block;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
}
 
input[type=url], select {
  width: 100%;
  padding: 12px 20px;
  margin: 8px 0;
  display: inline-block;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
}
 
input[type=submit] {
  width: 100%;
  background-color: #4CAF50;
  color: white;
  padding: 14px 20px;
  margin: 8px 0;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}
 
input[type=submit]:hover {
  background-color: #45a049;
}
 
div {
  border-radius: 5px;
  background-color: #f2f2f2;
  padding: 20px;
}

.flex{
	display: flex;
  justify-content :space-between;
}
.head{
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
 
  
}

.required {
    color: red;
}
</css>
        <data_table>sp_instance_table</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list>table</field_list>
        <has_preview>true</has_preview>
        <id>testingproductcreate</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {
  
}]]></link>
        <name>testingproductCreate</name>
        <option_schema>[{"displayValue":"Page","name":"redirect_url","section":"Presentation","default_value":"product","label":"url","type":"reference","value":"sp_page","ed":{"reference":"sp_page"}}]</option_schema>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function(){

	data.cat = [];
	var catgr = new GlideRecord('x_rptp_insureme_insurance_product_category');
	catgr.query();

	data.list = ["category_code"];

	while (catgr.next()) {
		data.list.forEach(function(field) {
			data.cat.push(catgr.getDisplayValue(field));
		});
	}


	try {
		// Get table name from widget input
		data.table = $sp.getValue("table");


		// Create GlideRecord for the specified table
		var gr = new GlideRecord(data.table);


		// Check if prod_name already exists
		gr.addQuery("prod_name", input.temp1);
		gr.query();
		if (gr.next()) {
			var errorMessage = "Product name already exists.";
			gs.addErrorMessage(errorMessage);
			data.errorMessage = errorMessage;
			current.setAbortAction(true);
			return errorMessage;
		}


		// Check if prod_code already exists
		gr.initialize();
		gr.addQuery("prod_code", input.temp3);
		gr.query();
		if (gr.next()) {
			var errorMessages = "Product code already exists.";
			gs.addErrorMessage(errorMessages);
			data.errorMessage = errorMessages;
			current.setAbortAction(true);
			return errorMessages;
		}


		// Insert new record
		gr.initialize();
		gr.setValue("prod_name", input.temp1);
		gr.setValue("prod_desc", input.temp2);
		gr.setValue("prod_code", input.temp3);
		gr.setValue("prod_image", input.temp4);
		gr.setValue("category_code", input.temp5);
		gr.setValue("active", true);
		gr.insert();

		// Log success message
		var successMessage = "Record inserted successfully.";
		gs.addInfoMessage(successMessage);
		data.successMessage = successMessage;
		return successMessage;
	} catch (e) {
		// Log error details
		gs.error("An error occurred: " + e);

		// Log additional information for debugging
		gs.error("Table Name: " + data.table);
		gs.error("Input Data: " + JSON.stringify(input));

		return "Error: " + e;
	}




	/*
	data.cat=[];
	var catgr=new GlideRecord('x_rptp_insureme_insurance_product_category');
	catgr.query();

	while (catgr.next()){
		var j={};
		var arr=catgr.category_code.toString();		
		arr=arr.split('-');
		c="";
		arr.forEach(func2);
		j.code=c;
		data.cat.push(j);
	}

	function func2(element){
		var b=element.toLowerCase();
		b=b[0].toUpperCase()+b.substring(1);
		c=c+" "+b;
	}	
	*/


	/*
	data.cat = [];
data.list = ["category_code"];

var catgr = new GlideRecord('x_rptp_insureme_insurance_product_category');
catgr.query();

while (catgr.next()) {
  var obj = {};
  data.list.forEach(function(field) {
    obj[field] = catgr.getDisplayValue(field);
  });

  data.cat.push(obj);
}
*/



})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>akshay</sys_created_by>
        <sys_created_on>2024-02-20 05:13:48</sys_created_on>
        <sys_id>01e3021047ecc29055784a02516d431e</sys_id>
        <sys_mod_count>18</sys_mod_count>
        <sys_name>testingproductCreate</sys_name>
        <sys_package display_value="SmartAssurance old" source="x_rptp_insureme">87b3cc0b4775711055784a02516d4350</sys_package>
        <sys_policy/>
        <sys_scope display_value="SmartAssurance old">87b3cc0b4775711055784a02516d4350</sys_scope>
        <sys_update_name>sp_widget_01e3021047ecc29055784a02516d431e</sys_update_name>
        <sys_updated_by>akshay</sys_updated_by>
        <sys_updated_on>2024-02-20 06:18:58</sys_updated_on>
        <template><![CDATA[<div>
  
  <div admin-back-button class="bt"></div>
  <form >
    <div class = "head"> 
      <h2>Please fill the New Product details here:</h2>
      <img ng-src="https://th.bing.com/th?id=OIP.ha59T_qkxIapRr_WWUtGnQHaHa&w=250&h=250&c=8&rs=1&qlt=90&o=6&dpr=1.3&pid=3.1&rm=2" style="width:300px"/>
    </div>
    <br />
    	
    <b>Category Name: <span class="required">*</span></b>
    <select id="catName" ng-model="c.cName" required class="dropdown">
      <option id ="choose_here" value="345" selected disabled hidden>Choose here...</option>
      <option ng-repeat="key in data.cat" ng-attr-id="option_{{$index}}" value="{{key}}">{{key}}</option>
    </select>
    
    <b>Product Name: <span class="required">*</span></b>
    <input id="prodName" type="text" name="cat_name" ng-model="c.pn" required />
     <span style="color: {{errorInValue ? 'red' : 'transparent'}};" >{{errorInValue}}</span>
    
    <br />
    <b>Product Code: <span class="required">*</span></b>
    <input  id="prodCode" type="text" name="cat_code" ng-model="c.pc" required />
    <br />
    <b>Product Description:</b>
    <input id="prodDesc" type="text" name="sh_desc" ng-model="c.pdes" />
    <br />


    <div>
      <b>Product Image:</b>
      <input id ="image_id" type="file" name="prod_img" ng-model="c.pimg" accept="image/*" />

    </div>

    <div class="hidden">
      <b>Active:</b>
      <input type="checkbox" name="isa" ng-model="c.pia" />
    </div>
    <br />
    <input  id="submit!" type="submit" value="Create Product" ng-click="c.submit()" />
  </form> 
</div>
]]></template>
    </sp_widget>
</record_update>
